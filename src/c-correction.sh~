#!/bin/sh
#
# C-correction of a multi-spectral image
# Uses masks generated by Gaussian mixture clustering on first 4 PCs
#
# Usage:
#
#  ./c-correction spatialDims bandPos numClasses solarAzimuth solarElevation msImage demImage
echo 
echo "--------------------------------------------------"
echo "                  C-Correction"
echo "--------------------------------------------------"
echo MS image: $6
echo DEM image: $7
echo spatial subset: $1
echo spectral subset: $2
echo number of classes: $3
echo solar azimuth $4:
echo solar elevation $5:
imagePixelSize=$(gdalinfo $6 | grep Pixel | awk '{print $4}')
demPixelSize=$(gdalinfo $7 | grep Pixel | awk '{print $4}')  
echo Image pixel size: $imagePixelSize
echo DEM pixel size: $demPixelSize	   
echo ' '
echo Running PCA...
pcaImage=$(python crc/pca.py -n -d $1 -p $2 $6 \
	   | grep written \
	   | awk '{print $4}')
echo PCA Image: $pcaImage
echo ' '
echo Running EM on first 4 PCs with $3 classes...
classImage=$(python crc/em.py -d $1 -p [1,2,3] -K $3 $pcaImage \
	   | grep written \
	   | awk '{print $5}')
echo Class image: $classImage
echo ' '
echo Running c-correction...
#c_correctImage=$(python crc/c_corr.py -d $1 -p $2 -c $classImage $6 $7 \
#	   | grep written \
#	   | awk '{print $5}')

